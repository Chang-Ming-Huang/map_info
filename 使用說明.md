# Google Maps 評論爬蟲使用說明

## 概述

本項目是一套完整的 Google Maps 評論爬蟲工具，專門用於爬取築宜系統傢俱桃園店的評論數據，支援評論文字提取和圖片自動下載功能。

## 檔案結構

```
map_info/
├── requirements.txt              # Python 依賴套件
├── google_reviews_scraper.py    # 主要爬蟲程式
├── image_handler.py             # 圖片處理模組
├── 使用說明.md                  # 本說明檔案
├── CLAUDE.md                    # 專案開發記錄
├── .gitignore                   # Git 忽略檔案
├── YYYYMMDD_HHMMSS.json         # 評論數據輸出檔案
└── images/
    └── YYYYMMDD_HHMMSS/         # 下載的圖片目錄
```

## 功能特色

### 1. 主要爬蟲程式 (google_reviews_scraper.py)
- **前置滾動優化**: 執行30次前置滾動，每次滾動後檢查並點擊「更多評論」按鈕
- **智能循環爬取**: 滾動→檢查→下載→判斷的循環邏輯
- **自動化瀏覽器操作**: 使用 Selenium 模擬真實用戶行為
- **評論去重處理**: 基於唯一ID避免重複爬取
- **反爬蟲機制**: 隨機延遲、User-Agent 輪替、錯誤重試

### 2. 圖片處理模組 (image_handler.py)
- **自動圖片下載**: 每則評論自動下載前3張圖片
- **高解析度轉換**: 將縮圖URL轉換為高解析度版本
- **圖片去重機制**: URL快取避免重複下載
- **背景圖片提取**: 直接從CSS背景圖片提取URL
- **檔案管理**: 自動建立目錄並命名檔案

### 3. 配置系統
- **UserConfig**: 用戶層設定（評論數量、圖片下載開關）
- **ScrapingConfig**: 技術層設定（滾動參數、延遲時間）
- **UTF-8編碼**: 完整支援繁體中文內容

## 使用步驟

### 1. 環境準備
```bash
# 安裝依賴套件 (如果需要)
pip install -r requirements.txt

# 確認 Chrome 瀏覽器已安裝
google-chrome --version
```

### 2. 配置設定
在執行前可調整 `google_reviews_scraper.py` 中的配置：
```python
class UserConfig(Enum):
    WANTED_REVIEWS = 10       # 期望的評論數量
    ENABLE_IMAGES = True      # 是否下載圖片

class ScrapingConfig(Enum):
    MAX_SCROLLS = 15          # 最大滾動次數
    HEADLESS_MODE = False     # 是否無頭模式
    DOWNLOAD_IMAGES = True    # 是否下載圖片
```

### 3. 執行爬蟲
```bash
# Windows PowerShell
python google_reviews_scraper.py

# Linux/Mac
python3 google_reviews_scraper.py
```

## 爬蟲結果

### 築宜系統傢俱-桃園店 爬蟲結果 (最新)
- **總評論數**: 10 個 (目標數量)
- **平均評分**: 5.00 星 (全部五星好評)
- **圖片下載**: 30 張圖片 (每則評論3張)
- **主要設計師**: Roy、Nick、張明發
- **執行時間**: 約1-2分鐘
- **前置滾動**: 30次滾動優化載入

## 輸出檔案說明

### JSON 格式
```json
[
  {
    "business_name": "築宜系統傢俱",
    "location": "桃園店",
    "search_keyword": "",
    "scraping_mode": 0,
    "reviewer_name": "評論者姓名",
    "rating": 5,
    "review_text": "評論內容",
    "review_date": "發布日期",
    "scraped_at": "爬取時間",
    "review_id": 1,
    "images": [
      "review_001_img_01.jpg",
      "review_001_img_02.jpg"
    ],
    "total_images": 2,
    "images_downloaded": true,
    "image_directory": "images/YYYYMMDD_HHMMSS"
  }
]
```

### 圖片檔案
- **命名規則**: `review_XXX_img_YY.jpg`
- **儲存位置**: `images/YYYYMMDD_HHMMSS/`
- **圖片品質**: 高解析度原始圖片

## 技術細節

### 前置滾動優化
1. **30次前置滾動**: 在正式爬取前先滾動30次預載內容
2. **交替檢查機制**: 每次滾動後檢查「更多評論」按鈕並點擊
3. **智能觸底判斷**: 連續20次無新評論則停止爬取
4. **滾動成功驗證**: 檢查滾動位置變化確保有效滾動

### 反爬蟲策略
1. **隨機 User-Agent**: 輪替不同的瀏覽器標識
2. **隨機延遲**: 0.5-2秒的隨機等待時間
3. **錯誤重試**: 自動重試失敗的操作
4. **可視化模式**: 預設顯示瀏覽器便於監控

### 數據提取策略
- **多重選擇器**: 使用多種 CSS/XPath 選擇器確保兼容性
- **評論去重**: 基於唯一ID避免重複處理
- **循環式爬取**: 滾動→檢查→下載→判斷的穩定循環

## 注意事項

### 法律和倫理考量
1. **遵守服務條款**: 確保使用符合 Google 服務條款
2. **合理使用**: 避免過度頻繁的請求
3. **數據保護**: 妥善處理用戶評論數據
4. **商業用途**: 了解商業使用的限制

### 技術限制
1. **頁面結構變更**: Google Maps 頁面結構可能隨時改變
2. **反爬蟲機制**: Google 的反爬蟲機制可能導致封鎖
3. **網路環境**: 需要穩定的網路連線
4. **瀏覽器依賴**: 需要安裝 Chrome 瀏覽器

## 故障排除

### 常見問題
1. **找不到評論按鈕**: 檢查頁面 URL 是否正確
2. **無法載入更多評論**: 調整滾動次數和等待時間
3. **Chrome 驅動程式問題**: webdriver-manager 會自動下載最新驅動

### 調試建議
1. 將 `headless=False` 觀察瀏覽器行為
2. 檢查 debug_screenshot 截圖
3. 查看控制台輸出的錯誤信息

## 擴展功能

### 自定義目標
修改 `main()` 函數中的 URL 來爬取其他商家：
```python
url = "你的目標商家 Google Maps URL"
```

### 調整參數
- `max_scrolls`: 調整滾動次數
- `headless`: 設為 True 在背景運行
- 延遲時間: 根據網路狀況調整

## 更新維護

由於 Google Maps 的頁面結構可能會變更，建議：
1. 定期更新選擇器
2. 監控爬蟲成功率
3. 根據需要調整反爬蟲策略

## 聯繫支援

如有技術問題或改進建議，請檢查：
1. 錯誤日誌和截圖
2. 網路連線狀況
3. Chrome 瀏覽器版本

---

**警告**: 本工具僅供學習和研究使用。使用前請確保遵守相關法律法規和服務條款。